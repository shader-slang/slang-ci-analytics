<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Statistics - Slang CI Analytics</title>
<style>
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; background: #fff; color: #333; }
  nav a { color: #adb5bd; text-decoration: none; }
  nav a:hover { color: white; }
  .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
  h1, h2, h3 { color: #212529; }
  table { border-collapse: collapse; width: 100%; }
  th, td { border: 1px solid #dee2e6; padding: 8px; text-align: left; }
  th { background: #f8f9fa; }
  .chart-container { position: relative; width: 100%; max-width: 1200px; margin: 20px 0; }
  .stat-card { display: inline-block; background: #f8f9fa; border-radius: 8px; padding: 15px 25px; margin: 5px; text-align: center; }
  .stat-card .value { font-size: 2em; font-weight: bold; color: #212529; }
  .stat-card .label { font-size: 0.9em; color: #6c757d; }
</style>
</head>
<body>
<nav style="background:#343a40;padding:10px 20px;color:white;font-family:sans-serif">
  <strong>Slang CI Analytics</strong> &nbsp;|&nbsp; <a href="index.html">Home</a> &nbsp;|&nbsp; <a href="statistics.html" style="font-weight:bold;text-decoration:underline">Statistics</a> &nbsp;|&nbsp; <a href="capacity.html">Capacity</a>
</nav>
<div class="container">

<h1>Statistics &amp; Trends</h1>

<div style="margin-bottom:15px">
  <label>Date range: </label>
  <select id="rangeSelect" onchange="updateRange()">
    <option value="7">Last 7 days</option>
    <option value="30" selected>Last 30 days</option>
    <option value="90">Last 90 days</option>
    <option value="0">All time</option>
  </select>
</div>

<h2>CI Turnaround Time (minutes)</h2>
<p style="color:#6c757d;font-size:0.9em">Main CI workflow only. Time from workflow trigger to last job completed per run. Speed of light = max(build+test) across platforms, assuming full parallelization.</p>
<div class="chart-container"><canvas id="turnaround"></canvas></div>

<h2>Active PRs per Day</h2>
<div class="chart-container"><canvas id="prsPerDay"></canvas></div>

<h2>Build Duration by OS (minutes)</h2>
<p style="color:#6c757d;font-size:0.9em">Average build job duration per day, CI workflow only.</p>
<div class="chart-container"><canvas id="buildByOs"></canvas></div>

<h2>Test Duration by OS (minutes)</h2>
<p style="color:#6c757d;font-size:0.9em">Average test job duration per day, CI workflow only.</p>
<div class="chart-container"><canvas id="testByOs"></canvas></div>

<h2>Jobs per Day</h2>
<div class="chart-container"><canvas id="jobsPerDay"></canvas></div>

<h2>Workflow Runs per Day</h2>
<div class="chart-container"><canvas id="runsPerDay"></canvas></div>

<h2>Average Job Duration (minutes)</h2>
<div class="chart-container"><canvas id="avgDuration"></canvas></div>

<h2>Average Queue Wait Time (minutes)</h2>
<div class="chart-container"><canvas id="avgQueue"></canvas></div>

<h2>Failure Rate (%)</h2>
<div class="chart-container"><canvas id="failureRate"></canvas></div>

<h2>Jobs by Runner Group</h2>
<div class="chart-container" style="max-width:800px"><canvas id="byGroup"></canvas></div>

<h2>Jobs by Event Type</h2>
<div class="chart-container" style="max-width:500px"><canvas id="byEvent"></canvas></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const allLabels = ["2026-01-26", "2026-01-27", "2026-01-28", "2026-01-29", "2026-01-30", "2026-01-31", "2026-02-01", "2026-02-02", "2026-02-03", "2026-02-04", "2026-02-05", "2026-02-06", "2026-02-07", "2026-02-08", "2026-02-09", "2026-02-10", "2026-02-11", "2026-02-12", "2026-02-13", "2026-02-14", "2026-02-15", "2026-02-16", "2026-02-17", "2026-02-18", "2026-02-19", "2026-02-20", "2026-02-21", "2026-02-23", "2026-02-24"];
const allSuccess = [1220, 709, 880, 1465, 1327, 265, 95, 1078, 1292, 1100, 1209, 982, 124, 94, 788, 1388, 1884, 2159, 1106, 249, 58, 776, 801, 913, 1196, 1025, 154, 2012, 1888];
const allFailure = [14, 47, 54, 106, 94, 14, 9, 41, 57, 45, 122, 100, 26, 55, 74, 74, 85, 108, 95, 11, 6, 59, 37, 73, 77, 79, 10, 180, 173];
const allCancelled = [9, 57, 29, 200, 150, 35, 24, 95, 223, 156, 274, 299, 26, 42, 112, 161, 208, 149, 51, 12, 0, 99, 56, 85, 95, 56, 0, 226, 276];
const allRuns = [54, 36, 42, 69, 64, 15, 4, 49, 67, 53, 70, 61, 8, 10, 38, 66, 84, 102, 58, 11, 2, 35, 30, 41, 56, 50, 9, 97, 113];
const allPRs = [24, 19, 20, 22, 23, 7, 2, 21, 24, 21, 21, 15, 2, 1, 13, 29, 33, 36, 26, 7, 2, 16, 19, 18, 21, 19, 4, 47, 39];
const allDuration = [9.7, 10.1, 9.8, 11.9, 10.0, 9.3, 8.7, 9.3, 8.9, 9.3, 8.4, 10.3, 8.9, 7.8, 9.1, 9.4, 9.2, 7.9, 7.9, 8.4, 7.8, 8.2, 7.8, 7.9, 8.1, 8.4, 8.1, 7.6, 7.6];
const allMaDuration = [9.7, 9.9, 9.9, 10.4, 10.3, 10.1, 9.9, 9.9, 9.7, 9.6, 9.1, 9.2, 9.1, 9.0, 9.0, 9.0, 9.0, 8.9, 8.6, 8.5, 8.5, 8.4, 8.2, 8.0, 8.0, 8.1, 8.0, 8.0, 7.9];
const allQueue = [48.6, 4.5, 4.5, 4.6, 6.1, 3.0, 0.5, 7.5, 4.4, 5.8, 3.4, 2.1, 1.4, 0.2, 2.6, 7.1, 19.3, 29.3, 12.4, 3.4, 0.7, 7.9, 4.0, 8.8, 14.5, 7.0, 1.8, 32.2, 17.0];
const allFailRate = [1.1, 5.8, 5.6, 6.0, 6.0, 4.5, 7.0, 3.4, 3.6, 3.5, 7.6, 7.2, 14.8, 28.8, 7.6, 4.6, 3.9, 4.5, 7.6, 4.0, 9.4, 6.3, 4.1, 6.8, 5.6, 6.8, 6.1, 7.4, 7.4];
const allTurnAvg = [148.4, 42.2, 43.5, 52.4, 50.3, 36.7, 34.0, 52.7, 37.5, 46.7, 35.4, 35.9, 33.5, 20.9, 43.6, 49.3, 116.9, 167.2, 88.3, 42.8, 21.2, 58.3, 37.9, 57.8, 79.0, 67.3, 47.9, 204.4, 106.3];
const allTurnMedian = [92.4, 40.8, 39.5, 66.8, 45.9, 44.2, 41.1, 46.9, 41.1, 42.6, 37.1, 35.2, 36.3, 22.9, 39.5, 39.2, 116.9, 157.1, 75.6, 48.2, 41.9, 42.7, 37.7, 44.7, 65.5, 56.2, 44.9, 202.9, 84.8];
const allTurnP95 = [361.1, 104.1, 98.0, 83.6, 111.3, 73.1, 41.7, 135.8, 85.6, 125.5, 88.7, 113.0, 59.6, 51.1, 108.2, 140.6, 297.4, 344.1, 216.6, 58.0, 41.9, 165.7, 73.1, 173.2, 242.2, 170.1, 71.5, 478.5, 245.0];
const allSoL = [43.2, 40.1, 41.0, 62.0, 39.5, 35.9, 36.0, 35.4, 29.8, 34.6, 27.5, 33.7, 31.8, 21.7, 39.0, 33.8, 37.8, 42.9, 44.1, 43.2, 43.9, 38.1, 44.7, 39.2, 41.4, 39.8, 41.8, 37.1, 33.4];

let charts = [];

function sliceData(arr, n) {
  return n === 0 ? arr : arr.slice(-n);
}

function makeChart(id, type, config) {
  const ctx = document.getElementById(id).getContext('2d');
  const c = new Chart(ctx, {type, ...config});
  charts.push({chart: c, id, type, config});
  return c;
}

function updateRange() {
  const n = parseInt(document.getElementById('rangeSelect').value);
  const labs = sliceData(allLabels, n);
  charts.forEach(item => {
    const c = item.chart;
    c.data.labels = labs;
    c.data.datasets.forEach((ds, i) => {
      if (ds._allData) ds.data = sliceData(ds._allData, n);
    });
    c.update();
  });
}

// CI Turnaround time
makeChart('turnaround', 'line', {
  data: {
    labels: sliceData(allLabels, 30),
    datasets: [
      {label:'Average', data:sliceData(allTurnAvg,30), _allData:allTurnAvg, borderColor:'#0d6efd', fill:false, tension:0.1},
      {label:'Median', data:sliceData(allTurnMedian,30), _allData:allTurnMedian, borderColor:'#28a745', fill:false, tension:0.1},
      {label:'p95', data:sliceData(allTurnP95,30), _allData:allTurnP95, borderColor:'#dc3545', borderDash:[5,5], fill:false, tension:0.1},
      {label:'Speed of Light', data:sliceData(allSoL,30), _allData:allSoL, borderColor:'#6c757d', borderDash:[2,4], fill:false, tension:0.1, pointStyle:'triangle'},
    ]
  },
  options: {responsive:true, scales:{y:{title:{display:true,text:'Minutes'}}}}
});

// Build duration by OS
makeChart('buildByOs', 'line', {
  data: {
    labels: sliceData(allLabels, 30),
    datasets: [{label:'linux', data:sliceData([21.1, 20.9, 20.3, 30.0, 19.2, 16.0, 17.3, 15.5, 13.2, 15.0, 12.3, 16.3, 13.6, 11.6, 13.5, 14.8, 13.5, 8.9, 10.3, 9.8, 8.5, 10.1, 8.7, 9.7, 9.8, 10.7, 9.2, 7.9, 8.3],30), _allData:[21.1, 20.9, 20.3, 30.0, 19.2, 16.0, 17.3, 15.5, 13.2, 15.0, 12.3, 16.3, 13.6, 11.6, 13.5, 14.8, 13.5, 8.9, 10.3, 9.8, 8.5, 10.1, 8.7, 9.7, 9.8, 10.7, 9.2, 7.9, 8.3], borderColor:'#0d6efd', fill:false, tension:0.1},{label:'macos', data:sliceData([18.8, 19.0, 18.5, 17.6, 16.8, 16.5, 16.8, 16.7, 15.0, 15.5, 12.1, 18.0, 12.7, 9.6, 13.5, 15.8, 15.4, 9.4, 8.3, 7.0, 6.7, 8.9, 6.5, 7.8, 8.2, 8.6, 10.0, 8.6, 8.5],30), _allData:[18.8, 19.0, 18.5, 17.6, 16.8, 16.5, 16.8, 16.7, 15.0, 15.5, 12.1, 18.0, 12.7, 9.6, 13.5, 15.8, 15.4, 9.4, 8.3, 7.0, 6.7, 8.9, 6.5, 7.8, 8.2, 8.6, 10.0, 8.6, 8.5], borderColor:'#28a745', fill:false, tension:0.1},{label:'materialx', data:sliceData([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],30), _allData:[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], borderColor:'#ffc107', fill:false, tension:0.1},{label:'slangpy', data:sliceData([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],30), _allData:[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], borderColor:'#dc3545', fill:false, tension:0.1},{label:'windows', data:sliceData([7.7, 7.9, 7.8, 7.0, 8.0, 11.4, 10.4, 8.6, 8.1, 7.8, 6.8, 15.3, 7.6, 10.0, 14.2, 9.3, 9.1, 8.7, 9.5, 8.3, 7.3, 9.8, 8.4, 8.6, 9.9, 10.6, 10.1, 10.3, 8.8],30), _allData:[7.7, 7.9, 7.8, 7.0, 8.0, 11.4, 10.4, 8.6, 8.1, 7.8, 6.8, 15.3, 7.6, 10.0, 14.2, 9.3, 9.1, 8.7, 9.5, 8.3, 7.3, 9.8, 8.4, 8.6, 9.9, 10.6, 10.1, 10.3, 8.8], borderColor:'#6f42c1', fill:false, tension:0.1}]
  },
  options: {responsive:true, scales:{y:{title:{display:true,text:'Minutes'}}}}
});

// Test duration by OS
makeChart('testByOs', 'line', {
  data: {
    labels: sliceData(allLabels, 30),
    datasets: [{label:'linux', data:sliceData([7.6, 7.1, 7.6, 7.1, 7.1, 6.3, 5.1, 6.3, 6.4, 6.7, 6.4, 6.0, 6.9, 3.0, 6.1, 6.4, 6.5, 6.6, 6.6, 7.5, 6.2, 6.6, 7.3, 7.2, 7.1, 6.4, 6.4, 6.3, 6.1],30), _allData:[7.6, 7.1, 7.6, 7.1, 7.1, 6.3, 5.1, 6.3, 6.4, 6.7, 6.4, 6.0, 6.9, 3.0, 6.1, 6.4, 6.5, 6.6, 6.6, 7.5, 6.2, 6.6, 7.3, 7.2, 7.1, 6.4, 6.4, 6.3, 6.1], borderColor:'#0d6efd', fill:false, tension:0.1},{label:'macos', data:sliceData([3.3, 3.4, 3.3, 3.2, 3.2, 3.0, 2.5, 3.2, 3.2, 3.2, 3.1, 3.1, 2.8, 2.6, 3.2, 3.2, 3.4, 3.2, 3.2, 3.0, 3.0, 3.0, 3.5, 3.1, 3.1, 3.2, 3.0, 3.1, 3.3],30), _allData:[3.3, 3.4, 3.3, 3.2, 3.2, 3.0, 2.5, 3.2, 3.2, 3.2, 3.1, 3.1, 2.8, 2.6, 3.2, 3.2, 3.4, 3.2, 3.2, 3.0, 3.0, 3.0, 3.5, 3.1, 3.1, 3.2, 3.0, 3.1, 3.3], borderColor:'#28a745', fill:false, tension:0.1},{label:'materialx', data:sliceData([7.3, 9.6, 9.7, 9.8, 10.1, 9.1, 7.3, 9.5, 9.7, 9.1, 9.3, 8.7, 8.7, 8.3, 9.6, 9.6, 9.6, 10.1, 10.1, 9.8, 9.9, 10.0, 9.8, 9.8, 10.1, 10.1, 9.8, 9.8, 10.3],30), _allData:[7.3, 9.6, 9.7, 9.8, 10.1, 9.1, 7.3, 9.5, 9.7, 9.1, 9.3, 8.7, 8.7, 8.3, 9.6, 9.6, 9.6, 10.1, 10.1, 9.8, 9.9, 10.0, 9.8, 9.8, 10.1, 10.1, 9.8, 9.8, 10.3], borderColor:'#ffc107', fill:false, tension:0.1},{label:'slangpy', data:sliceData([0, 0, 0, 0, 0, 0, 0, 0, 3.8, 5.8, 3.5, 0, 0, 0, 3.3, 2.7, 0, 0, 0, 0, 0, 0, 3.2, 0, 0, 0, 0, 0, 0],30), _allData:[0, 0, 0, 0, 0, 0, 0, 0, 3.8, 5.8, 3.5, 0, 0, 0, 3.3, 2.7, 0, 0, 0, 0, 0, 0, 3.2, 0, 0, 0, 0, 0, 0], borderColor:'#dc3545', fill:false, tension:0.1},{label:'windows', data:sliceData([13.7, 14.8, 14.0, 14.0, 14.3, 14.1, 12.0, 13.9, 14.3, 14.4, 14.5, 13.5, 12.9, 11.7, 14.4, 15.0, 16.1, 16.2, 14.4, 17.1, 17.0, 16.3, 15.7, 15.3, 16.1, 17.1, 15.9, 16.6, 17.3],30), _allData:[13.7, 14.8, 14.0, 14.0, 14.3, 14.1, 12.0, 13.9, 14.3, 14.4, 14.5, 13.5, 12.9, 11.7, 14.4, 15.0, 16.1, 16.2, 14.4, 17.1, 17.0, 16.3, 15.7, 15.3, 16.1, 17.1, 15.9, 16.6, 17.3], borderColor:'#6f42c1', fill:false, tension:0.1}]
  },
  options: {responsive:true, scales:{y:{title:{display:true,text:'Minutes'}}}}
});

// Jobs per day (stacked bar)
makeChart('jobsPerDay', 'bar', {
  data: {
    labels: sliceData(allLabels, 30),
    datasets: [
      {label:'Success', data:sliceData(allSuccess,30), _allData:allSuccess, backgroundColor:'#28a745'},
      {label:'Failure', data:sliceData(allFailure,30), _allData:allFailure, backgroundColor:'#dc3545'},
      {label:'Cancelled', data:sliceData(allCancelled,30), _allData:allCancelled, backgroundColor:'#ffc107'},
    ]
  },
  options: {responsive:true, scales:{x:{stacked:true},y:{stacked:true}}}
});

// Active PRs per day
makeChart('prsPerDay', 'line', {
  data: {
    labels: sliceData(allLabels, 30),
    datasets: [{label:'Active PRs', data:sliceData(allPRs,30), _allData:allPRs, borderColor:'#28a745', fill:true, backgroundColor:'rgba(40,167,69,0.1)', tension:0.1}]
  },
  options: {responsive:true}
});

// Runs per day
makeChart('runsPerDay', 'line', {
  data: {
    labels: sliceData(allLabels, 30),
    datasets: [{label:'Workflow Runs', data:sliceData(allRuns,30), _allData:allRuns, borderColor:'#0d6efd', fill:false, tension:0.1}]
  },
  options: {responsive:true}
});

// Average duration
makeChart('avgDuration', 'line', {
  data: {
    labels: sliceData(allLabels, 30),
    datasets: [
      {label:'Avg Duration', data:sliceData(allDuration,30), _allData:allDuration, borderColor:'#0d6efd', fill:false, tension:0.1},
      {label:'7-day MA', data:sliceData(allMaDuration,30), _allData:allMaDuration, borderColor:'#fd7e14', borderDash:[5,5], fill:false, tension:0.1},
    ]
  },
  options: {responsive:true}
});

// Queue wait time
makeChart('avgQueue', 'line', {
  data: {
    labels: sliceData(allLabels, 30),
    datasets: [{label:'Avg Queue (min)', data:sliceData(allQueue,30), _allData:allQueue, borderColor:'#6f42c1', fill:true, backgroundColor:'rgba(111,66,193,0.1)', tension:0.1}]
  },
  options: {responsive:true}
});

// Failure rate
makeChart('failureRate', 'line', {
  data: {
    labels: sliceData(allLabels, 30),
    datasets: [{label:'Failure Rate %', data:sliceData(allFailRate,30), _allData:allFailRate, borderColor:'#dc3545', fill:true, backgroundColor:'rgba(220,53,69,0.1)', tension:0.1}]
  },
  options: {responsive:true, scales:{y:{min:0,max:100}}}
});

// By runner group (static, no range filter)
new Chart(document.getElementById('byGroup').getContext('2d'), {
  type: 'bar',
  data: {
    labels: ["GitHub Linux ARM64", "GitHub Linux x64", "GitHub Windows", "GitHub macOS", "Linux GPU", "Other", "Windows GPU (GCP)"],
    datasets: [{label:'Jobs', data:[3995, 6534, 803, 8285, 5916, 6, 8077], backgroundColor:'#0d6efd'}]
  },
  options: {responsive:true, indexAxis:'y'}
});

// By event type (static)
new Chart(document.getElementById('byEvent').getContext('2d'), {
  type: 'pie',
  data: {
    labels: ["merge_group", "pull_request", "workflow_dispatch"],
    datasets: [{data:[5114, 28500, 2], backgroundColor:['#0d6efd','#28a745','#ffc107','#dc3545','#6f42c1','#fd7e14','#20c997','#e83e8c']}]
  },
  options: {responsive:true}
});
</script>

</div>
</body>
</html>